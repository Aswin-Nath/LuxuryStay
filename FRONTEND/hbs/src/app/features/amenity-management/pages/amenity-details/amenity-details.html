<app-admin-navbar></app-admin-navbar>

<div class="bg-gray-50 min-h-screen">
  <div class="flex flex-col lg:flex-row flex-1 w-full mt-16 md:mt-20">
    <!-- Sidebar -->
    <div class="w-full lg:w-64 px-4 md:px-6 lg:px-8 py-4 shrink-0">
      <app-admin-sidebar></app-admin-sidebar>
    </div>

    <!-- Main Content -->
    <main class="flex-1 w-full px-4 md:px-6 lg:px-8 py-4 space-y-4">
      <!-- Header -->
      <div class="relative rounded-lg p-[3px] bg-linear-to-r from-yellow-600 to-red-700 shadow">
        <div class="bg-[#fdfaf4] rounded-lg py-4 md:py-6 px-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h2 class="text-2xl md:text-3xl text-gray-800 font-bold">Room Types & Amenities</h2>
              <p class="text-gray-600 text-xs md:text-sm mt-1">Manage room types and amenities</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="bg-white rounded-lg shadow border-b border-gray-200">
        <div class="flex overflow-x-auto">
          <!-- Room Types Tab -->
          <button
            (click)="setActiveTab('room-types')"
            [class.active]="isActiveTab('room-types')"
            class="flex-1 min-w-[150px] px-4 py-3 font-medium text-center border-b-2 transition-all flex items-center justify-center gap-2 text-sm md:text-base"
            [ngClass]="{
              'border-yellow-600 text-yellow-600 bg-yellow-50': isActiveTab('room-types'),
              'border-transparent text-gray-600 hover:text-gray-900': !isActiveTab('room-types')
            }">
            <span class="material-icons text-lg">king_bed</span>
            <span class="hidden sm:inline">Room Types</span>
            <span class="sm:hidden">Types</span>
          </button>

          <!-- Amenities Tab -->
          <button
            (click)="setActiveTab('amenities')"
            [class.active]="isActiveTab('amenities')"
            class="flex-1 min-w-[150px] px-4 py-3 font-medium text-center border-b-2 transition-all flex items-center justify-center gap-2 text-sm md:text-base"
            [ngClass]="{
              'border-yellow-600 text-yellow-600 bg-yellow-50': isActiveTab('amenities'),
              'border-transparent text-gray-600 hover:text-gray-900': !isActiveTab('amenities')
            }">
            <span class="material-icons text-lg">star</span>
            <span class="hidden sm:inline">Amenities</span>
            <span class="sm:hidden">Amenities</span>
          </button>
        </div>
      </div>

      <!-- Room Types Tab Content -->
      <div *ngIf="isActiveTab('room-types')" class="space-y-3">
        <!-- Add New Room Type Button -->
        <button 
          (click)="openAddRoomTypeModal()"
          class="inline-flex items-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm md:text-base font-medium shadow">
          <span class="material-icons text-lg">add</span>
          <span>Add New Room Type</span>
        </button>

        <!-- Loading -->
        <div *ngIf="loadingRoomTypes" class="bg-white p-8 text-center rounded-lg shadow">
          <div class="inline-block">
            <div class="animate-spin h-8 w-8 border-4 border-yellow-600 border-t-transparent rounded-full"></div>
          </div>
          <p class="text-gray-600 mt-3 text-sm">Loading room types...</p>
        </div>

        <!-- Error -->
        <div *ngIf="errorRoomTypes && !loadingRoomTypes" class="bg-red-50 border border-red-200 p-3 rounded-lg text-red-700 text-sm">
          {{ errorRoomTypes }}
        </div>

        <!-- Room Types Table -->
        <div class="bg-white shadow-lg border border-gray-200 rounded-xl overflow-hidden" *ngIf="!loadingRoomTypes && roomTypes.length > 0">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-yellow-50 border-b border-gray-300">
                <tr>
                  <th class="p-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('type_name')">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-lg text-gray-500">king_bed</span>
                      <span>Type Name</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('type_name')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('description')">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-lg text-gray-500">description</span>
                      <span>Description</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('description')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('totalCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">home</span>
                      <span>Total</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('totalCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('availableCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">check_circle</span>
                      <span>Available</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('availableCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('bookedCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">event_busy</span>
                      <span>Booked</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('bookedCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('frozenCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">lock</span>
                      <span>Frozen</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('frozenCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortByColumn('maintenanceCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">build</span>
                      <span>Maintenance</span>
                      <i class="fas ml-1" [ngClass]="getSortIcon('maintenanceCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">settings</span>
                      Action
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr *ngFor="let roomType of roomTypes" class="hover:bg-gray-50">
                  <td class="p-3 font-medium text-blue-600">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-gray-600 text-sm">king_bed</span>
                      {{ roomType.type_name }}
                    </div>
                  </td>
                  <td class="p-3 text-gray-600">{{ roomType.description }}</td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs">{{ roomType.totalCount || 0 }}</span>
                  </td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs">{{ roomType.availableCount || 0 }}</span>
                  </td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs">{{ roomType.bookedCount || 0 }}</span>
                  </td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs">{{ roomType.frozenCount || 0 }}</span>
                  </td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs">{{ roomType.maintenanceCount || 0 }}</span>
                  </td>
                  <td class="p-3 text-center">
                    <div class="flex items-center justify-center gap-2">
                      <button (click)="viewRoomType(roomType.room_type_id)" class="px-2 py-1 text-yellow-700 hover:bg-yellow-100 rounded transition" title="View">
                        <span class="material-icons text-sm">visibility</span>
                      </button>
                      <button (click)="editRoomType(roomType.room_type_id)" class="px-2 py-1 text-yellow-700 hover:bg-yellow-100 rounded transition" title="Edit">
                        <span class="material-icons text-sm">edit</span>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loadingRoomTypes && roomTypes.length === 0" class="bg-white rounded-lg shadow p-8 text-center">
          <span class="material-icons text-5xl text-gray-300 block mb-3">king_bed</span>
          <p class="text-gray-600 text-sm">No room types found.</p>
        </div>
      </div>

      <!-- Amenities Tab Content -->
      <div *ngIf="isActiveTab('amenities')" class="space-y-3">
        <!-- Add New Amenity Button -->
        <button 
          (click)="openAddAmenityModal()"
          class="inline-flex items-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm md:text-base font-medium shadow">
          <span class="material-icons text-lg">add</span>
          <span>Add New Amenity</span>
        </button>

        <!-- Loading -->
        <div *ngIf="loadingAmenities" class="bg-white p-8 text-center rounded-lg shadow">
          <div class="inline-block">
            <div class="animate-spin h-8 w-8 border-4 border-yellow-600 border-t-transparent rounded-full"></div>
          </div>
          <p class="text-gray-600 mt-3 text-sm">Loading amenities...</p>
        </div>

        <!-- Error -->
        <div *ngIf="errorAmenities && !loadingAmenities" class="bg-red-50 border border-red-200 p-3 rounded-lg text-red-700 text-sm">
          {{ errorAmenities }}
        </div>

        <!-- Amenities Table -->
        <div class="bg-white shadow-lg border border-gray-200 rounded-xl overflow-hidden" *ngIf="!loadingAmenities && amenities.length > 0">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-yellow-50 border-b border-gray-300">
                <tr>
                  <th class="p-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortAmenitiesByColumn('amenity_name')">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-lg text-gray-500">star</span>
                      <span>Amenity Name</span>
                      <i class="fas ml-1" [ngClass]="getAmenitySortIcon('amenity_name')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-left font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortAmenitiesByColumn('description')">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-lg text-gray-500">description</span>
                      <span>Description</span>
                      <i class="fas ml-1" [ngClass]="getAmenitySortIcon('description')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700 cursor-pointer hover:bg-yellow-100" (click)="sortAmenitiesByColumn('roomCount')">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">home</span>
                      <span>Room Count</span>
                      <i class="fas ml-1" [ngClass]="getAmenitySortIcon('roomCount')"></i>
                    </div>
                  </th>
                  <th class="p-3 text-center font-semibold text-gray-700">
                    <div class="flex items-center justify-center gap-2">
                      <span class="material-icons text-lg text-gray-500">settings</span>
                      Action
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr *ngFor="let amenity of amenities" class="hover:bg-gray-50">
                  <td class="p-3 font-medium text-blue-600">
                    <div class="flex items-center gap-2">
                      <span class="material-icons text-gray-600 text-sm">star</span>
                      {{ amenity.amenity_name }}
                    </div>
                  </td>
                  <td class="p-3 text-gray-600">{{ amenity.description }}</td>
                  <td class="p-3 text-center font-semibold text-gray-700">
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs">{{ amenity.roomCount }} rooms</span>
                  </td>
                  <td class="p-3 text-center">
                    <div class="flex items-center justify-center gap-2">
                      <button 
                        (click)="showAmenityRooms(amenity)"
                        class="px-2 py-1 text-yellow-700 hover:bg-yellow-100 rounded transition" title="View">
                        <span class="material-icons text-sm">visibility</span>
                      </button>
                      <button (click)="openEditAmenityModal(amenity)" class="px-2 py-1 text-yellow-700 hover:bg-yellow-100 rounded transition" title="Edit">
                        <span class="material-icons text-sm">edit</span>
                      </button>
                      <button (click)="deleteAmenity(amenity.amenity_id)" class="px-2 py-1 text-red-700 hover:bg-red-100 rounded transition" title="Delete">
                        <span class="material-icons text-sm">delete</span>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loadingAmenities && amenities.length === 0" class="bg-white rounded-lg shadow p-8 text-center">
          <span class="material-icons text-5xl text-gray-300 block mb-3">star</span>
          <p class="text-gray-600 text-sm">No amenities found.</p>
        </div>
      </div>

      <!-- Amenity Rooms Modal -->
      <div *ngIf="selectedAmenityForRooms" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-auto">
          <!-- Modal Header -->
          <div class="sticky top-0 bg-linear-to-r from-yellow-600 to-red-700 text-white p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="material-icons">star</span>
              <div>
                <h3 class="font-semibold">{{ selectedAmenityForRooms.amenity_name }}</h3>
                <p class="text-xs opacity-90">{{ selectedAmenityForRooms.roomCount }} rooms have this amenity</p>
              </div>
            </div>
            <button (click)="closeAmenityRooms()" class="hover:bg-white hover:bg-opacity-20 rounded-lg p-1 transition">
              <span class="material-icons">close</span>
            </button>
          </div>

          <!-- Modal Content -->
          <div class="p-4">
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-3 py-2 text-left font-semibold text-gray-700 text-xs">Room No</th>
                    <th class="px-3 py-2 text-left font-semibold text-gray-700 text-xs">Status</th>
                    <th class="px-3 py-2 text-center font-semibold text-gray-700 text-xs">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let room of amenityRooms" class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-3 py-2 font-medium text-gray-800">{{ room.room_no }}</td>
                    <td class="px-3 py-2">
                      <span class="px-2 py-1 rounded text-xs font-medium"
                        [ngClass]="{
                          'bg-green-100 text-green-700': room.room_status === 'AVAILABLE',
                          'bg-blue-100 text-blue-700': room.room_status === 'BOOKED',
                          'bg-red-100 text-red-700': room.room_status === 'FROZEN',
                          'bg-yellow-100 text-yellow-700': room.room_status === 'MAINTENANCE'
                        }">
                        {{ room.room_status }}
                      </span>
                    </td>
                    <td class="px-3 py-2 text-center">
                      <div class="flex gap-1 justify-center flex-wrap">
                        <button (click)="openEditRoomFromAmenity(room)" class="inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100 transition text-xs">
                          <span class="material-icons text-sm">edit</span>
                          <span class="hidden sm:inline">Edit</span>
                        </button>
                        <button (click)="unmapAmenity(selectedAmenityForRooms.amenity_id, room.room_id)" class="inline-flex items-center gap-1 px-2 py-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition text-xs">
                          <span class="material-icons text-sm">link_off</span>
                          <span class="hidden sm:inline">Unmap</span>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Room Modal -->
      <app-edit-room 
        [isOpen]="showEditRoomModal" 
        [roomId]="editingRoomId"
        (close)="closeEditRoomModal()"
        (saved)="onRoomSaved()"
      ></app-edit-room>

      <!-- Edit Amenity Modal -->
      <app-edit-amenity 
        [isOpen]="showEditAmenityModal" 
        [amenityId]="editingAmenityId"
        [amenityName]="editingAmenityName"
        (close)="closeEditAmenityModal()"
        (saved)="onAmenitySaved()"
      ></app-edit-amenity>

      <!-- Add Amenity Modal -->
      <app-add-amenity 
        [isOpen]="showAddAmenityModal"
        (close)="closeAddAmenityModal()"
        (saved)="onAddAmenitySaved()"
      ></app-add-amenity>

      <!-- Add Room Modal -->
      <app-add-room 
        [isOpen]="showAddRoomModal"
        (close)="closeAddRoomModal()"
        (saved)="onAddRoomSaved()"
      ></app-add-room>

      <!-- Add Room Type Modal -->
      <app-add-room-type 
        [isOpen]="showAddRoomTypeModal"
        (close)="closeAddRoomTypeModal()"
        (saved)="onAddRoomTypeSaved()"
      ></app-add-room-type>
    </main>
  </div>
</div>
