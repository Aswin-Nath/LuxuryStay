<app-customer-navbar></app-customer-navbar>

<div class="bg-gray-50 flex flex-col min-h-screen">

  <div class="flex flex-col lg:flex-row flex-1 w-full mt-16 md:mt-20">

    <!-- Sidebar -->
    <div class="w-full lg:w-64 px-4 md:px-6 lg:px-8 py-6 shrink-0">
      <app-customer-sidebar [currentPage]="'bookings'"></app-customer-sidebar>
    </div>

    <!-- ✅ Main Content -->
<main class="flex-1 w-full mx-auto px-4 md:px-6 lg:px-8 py-6 space-y-8 max-w-5xl">

      <!-- ✅ Welcome Header -->
      <div class="relative rounded-2xl p-[3px] bg-linear-to-r from-yellow-600 to-red-700 shadow">
        <div class="bg-[#fdfaf4] rounded-2xl py-6 md:py-8 text-center">
            <h2 class="text-2xl md:text-3xl lg:text-4xl text-gray-800 font-bold">My Bookings</h2>
            <p class="text-sm sm:text-base text-gray-500 mt-2">View and manage all your hotel bookings</p>
          </div>
        </div>

        <!-- Filters Section - Optimized Single Row -->
        <div class="bg-white shadow-md border border-gray-200 rounded-lg p-4 sm:p-6 mb-6">
          <!-- Filter Controls - Single Row -->
          <div class="flex flex-wrap gap-4 items-end">
            <!-- Booking Status Dropdown -->
            <div class="min-w-max">
              <label class="block text-xs font-medium text-gray-600 mb-2">Booking Status</label>
              <select
                [(ngModel)]="selectedStatus"
                (change)="onStatusChange()"
                class="px-4 py-2 border border-gray-300 rounded-md text-sm bg-white focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 cursor-pointer font-medium text-gray-700 shadow-sm hover:shadow-md transition"
              >
                <option value="">All Statuses</option>
                <option *ngFor="let status of statusOptions" [value]="status">
                  {{ status }}
                </option>
              </select>
            </div>

            <!-- Room Type Dropdown -->
            <div class="min-w-max">
              <label class="block text-xs font-medium text-gray-600 mb-2">Room Type</label>
              <select
                [(ngModel)]="selectedRoomType"
                (change)="onRoomTypeChange()"
                class="px-4 py-2 border border-gray-300 rounded-md text-sm bg-white focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 cursor-pointer font-medium text-gray-700 shadow-sm hover:shadow-md transition"
              >
                <option value="">All Types</option>
                <option *ngFor="let roomType of roomTypeOptions" [value]="roomType.room_type_id">
                  {{ roomType.type_name }}
                </option>
              </select>
            </div>

            <!-- Min Amount -->
            <div class="min-w-max">
              <label class="block text-xs font-medium text-gray-600 mb-2">Total Amount (₹)</label>
              <div class="flex gap-2 items-center">
                <input
                  type="number"
                  [(ngModel)]="minAmount"
                  (change)="onFilterChange()"
                  (blur)="normalizeMinAmount()"
                  placeholder="Min ₹"
                  class="w-24 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"
                />
                <span class="text-gray-400">—</span>
                <input
                  type="number"
                  [(ngModel)]="maxAmount"
                  (change)="onFilterChange()"
                  (blur)="normalizeMaxAmount()"
                  placeholder="Max ₹"
                  class="w-24 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>

            <!-- Stay Period -->
            <div class="min-w-max">
              <label class="block text-xs font-medium text-gray-600 mb-2">Stay Period</label>
              <div class="flex gap-2 items-center">
                <input
                  type="date"
                  [(ngModel)]="checkInDate"
                  (change)="onDateChange()"
                  placeholder="mm/dd/yyyy"
                  class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"
                />
                <span class="text-gray-400">—</span>
                <input
                  type="date"
                  [(ngModel)]="checkOutDate"
                  (change)="onDateChange()"
                  placeholder="mm/dd/yyyy"
                  class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500"
                />
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-2">
              <button
                (click)="clearFilters()"
                class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition text-sm font-medium flex items-center gap-2"
              >
                <span class="material-icons text-sm">refresh</span>
                Reset
              </button>
              <button
                (click)="loadBookings()"
                class="px-6 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition text-sm font-medium flex items-center gap-2"
              >
                <span class="material-icons text-sm">filter_list</span>
                Apply
              </button>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-12">
          <div class="inline-block">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-600"></div>
            <p class="mt-4 text-gray-600">Loading bookings...</p>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="error && !isLoading" class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
          <p class="text-red-700 font-medium">{{ error }}</p>
        </div>

        <!-- No Results -->
        <div *ngIf="!isLoading && filteredBookings.length === 0" class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded text-center">
          <p class="text-blue-700 font-medium">No bookings found</p>
        </div>

        <!-- Bookings Table -->
        <div *ngIf="!isLoading && filteredBookings.length > 0" class="overflow-x-auto bg-white shadow-lg border border-gray-200 rounded-xl">
          <table class="w-full text-sm">
            <thead class="bg-linear-to-r from-yellow-600 to-red-600 text-white">
              <tr>
                <th class="px-4 py-3 text-left font-semibold">Booking ID</th>
                <th class="px-4 py-3 text-left font-semibold">Guest Name</th>
                <th class="px-4 py-3 text-left font-semibold">Check-in - Check-out</th>
                <th class="px-4 py-3 text-left font-semibold">Rooms</th>
                <th class="px-4 py-3 text-left font-semibold">Amount</th>
                <th class="px-4 py-3 text-left font-semibold">Status</th>
                <th class="px-4 py-3 text-center font-semibold">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <tr *ngFor="let booking of paginatedBookings" class="hover:bg-gray-50 transition">
                <td class="px-4 py-3">
                  <span class="font-medium text-gray-800">#{{ booking.booking_id }}</span>
                </td>
                <td class="px-4 py-3">
                  <div class="text-gray-800">{{ booking.primary_customer_name || 'N/A' }}</div>
                  <p class="text-xs text-gray-500 mt-0.5">{{ booking.primary_customer_phone_number || 'No phone' }}</p>
                </td>
                <td class="px-4 py-3">
                  <div class="text-gray-800 text-sm">
                    {{ formatDate(booking.check_in) }} → {{ formatDate(booking.check_out) }}
                  </div>
                  <p class="text-xs text-gray-500 mt-0.5">Booked: {{ formatBookingDate(booking.booking_time) }}</p>
                </td>
                <td class="px-4 py-3 text-center">
                  <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">
                    {{ booking.room_count }} room(s)
                  </span>
                </td>
                <td class="px-4 py-3">
                  <span class="font-semibold text-gray-800">₹{{ booking.total_price.toLocaleString() }}</span>
                </td>
                <td class="px-4 py-3">
                  <span [ngClass]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getStatusBadgeClass(booking.status)">
                    <span class="material-icons text-sm mr-1">{{ getStatusIcon(booking.status) }}</span>
                    {{ booking.status | uppercase }}
                  </span>
                </td>
                <td class="px-4 py-3 text-center">
                  <button
                    (click)="viewBookingDetails(booking.booking_id)"
                    class="inline-flex items-center gap-2 px-3 py-1 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition text-xs font-medium"
                  >
                    <span class="material-icons text-sm">visibility</span>
                    View
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <nav *ngIf="!isLoading && totalPages > 1" class="flex justify-between items-center mt-6">
          <button
            (click)="prevPage()"
            [disabled]="currentPage === 1"
            class="px-4 py-2 border rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            <span class="material-icons text-sm">chevron_left</span>
            Prev
          </button>

          <div class="flex gap-2">
            <button
              *ngFor="let page of [].constructor(totalPages); let i = index"
              (click)="goToPage(i + 1)"
              [ngClass]="{
                'bg-yellow-600 text-white': currentPage === i + 1,
                'bg-gray-200 hover:bg-yellow-100': currentPage !== i + 1
              }"
              class="px-3 py-2 rounded-lg transition"
            >
              {{ i + 1 }}
            </button>
          </div>

          <button
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            class="px-4 py-2 border rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            Next
            <span class="material-icons text-sm">chevron_right</span>
          </button>
        </nav>

      </main>
    </div>
  </div>