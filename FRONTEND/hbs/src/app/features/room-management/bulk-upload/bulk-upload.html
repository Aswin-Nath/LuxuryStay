<!-- Bulk Upload Modal -->
<div [ngClass]="{'hidden': !isOpen, 'fixed': isOpen}" class="inset-0 bg-black bg-opacity-50 z-50 items-center justify-center p-4" [style.display]="isOpen ? 'flex' : 'none'">
  <div class="bg-white w-full max-w-2xl rounded-2xl shadow-lg p-6 relative overflow-y-auto max-h-[90vh]">
    
    <!-- Close Button -->
    <button (click)="closeBulkUploadModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
      <span class="material-icons">close</span>
    </button>

    <!-- Modal Header -->
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-800">Bulk Add Rooms</h2>
      <p class="text-gray-600 text-sm mt-2">Import multiple individual rooms at once using CSV</p>
      <p class="text-xs text-orange-600 mt-1">⚠️ This adds rooms to EXISTING room types. To create new room types, use "Room Types & Amenities".</p>
    </div>

    <!-- Instructions -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
      <div class="flex gap-3">
        <span class="material-icons text-blue-600 mt-1">info</span>
        <div class="text-sm text-blue-800">
          <p class="font-semibold mb-2">What is this?</p>
          <p class="mb-2 text-xs">Add multiple room numbers to existing room types (e.g., Room 101, 102, 103 all as "Deluxe" type).</p>
          <p class="font-semibold mb-2">CSV Format Required:</p>
          <p class="mb-1"><strong>room_no</strong> - Room number (e.g., 101, 102) <span class="text-red-500">*</span></p>
          <p class="mb-1"><strong>room_type_name</strong> - Existing room type (e.g., "Deluxe") <span class="text-red-500">*</span></p>
          <p class="mb-1"><strong>room_status</strong> - Optional (AVAILABLE, BOOKED, MAINTENANCE, FROZEN)</p>
          <p class="mb-1"><strong>freeze_reason</strong> - Optional (NONE, CLEANING, ADMIN_LOCK, SYSTEM_HOLD)</p>
        </div>
      </div>
    </div>

    <!-- Download Template Section -->
    <div class="mb-6">
      <h3 class="font-semibold text-gray-700 mb-3">Step 1: Download Template</h3>
      <button (click)="downloadTemplate()" class="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition shadow">
        <span class="material-icons text-sm">download</span>
        Download CSV Template
      </button>
      <p class="text-xs text-gray-600 mt-2">Download our template to see the correct format with examples</p>
    </div>

    <!-- Upload Section -->
    <div class="mb-6">
      <h3 class="font-semibold text-gray-700 mb-3">Step 2: Upload CSV File</h3>
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-yellow-500 hover:bg-yellow-50 transition cursor-pointer">
        <input 
          type="file" 
          id="csvFileInput" 
          accept=".csv" 
          (change)="onFileSelected($event)"
          class="hidden"
          #fileInput
        />
        <button 
          type="button"
          (click)="fileInput.click()"
          class="text-gray-600 hover:text-gray-800 transition"
        >
          <span class="material-icons text-4xl text-yellow-600 mb-2">upload_file</span>
          <p class="text-sm font-medium">Click to select CSV file or drag and drop</p>
          <p class="text-xs text-gray-500 mt-1">Supported format: CSV (.csv)</p>
        </button>
      </div>
      <p *ngIf="selectedFileName" class="text-sm text-green-600 mt-2 flex items-center gap-1">
        <span class="material-icons text-sm">check_circle</span>
        Selected: {{ selectedFileName }}
      </p>
    </div>

    <!-- Example CSVs -->
    <div class="mb-6">
      <h3 class="font-semibold text-gray-700 mb-3">CSV Example Format:</h3>
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
        <p class="text-xs font-semibold text-gray-700 mb-2">Using Room Type Name (Required)</p>
        <pre class="text-xs text-gray-600 overflow-x-auto bg-white p-2 rounded border border-gray-200"><code>room_no,room_type_name,room_status,freeze_reason
101,Deluxe,AVAILABLE,NONE
102,Deluxe,AVAILABLE,NONE
201,Standard,AVAILABLE,NONE
202,Standard,MAINTENANCE,CLEANING</code></pre>
      </div>
    </div>

    <!-- Valid Values Info -->
    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
      <p class="text-xs font-semibold text-gray-700 mb-2">Valid Values:</p>
      <div class="grid grid-cols-2 gap-4 text-xs">
        <div>
          <p class="font-medium text-gray-700 mb-1">room_status:</p>
          <ul class="text-gray-600 space-y-1">
            <li>• AVAILABLE</li>
            <li>• BOOKED</li>
            <li>• MAINTENANCE</li>
            <li>• FROZEN</li>
          </ul>
        </div>
        <div>
          <p class="font-medium text-gray-700 mb-1">freeze_reason:</p>
          <ul class="text-gray-600 space-y-1">
            <li>• NONE</li>
            <li>• CLEANING</li>
            <li>• ADMIN_LOCK</li>
            <li>• SYSTEM_HOLD</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-end gap-3">
      <button 
        (click)="closeBulkUploadModal()" 
        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
      >
        Cancel
      </button>
      <button 
        (click)="handleBulkUpload()" 
        [disabled]="!selectedFile || isUploading"
        [class.opacity-50]="!selectedFile || isUploading"
        class="flex items-center gap-2 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition disabled:cursor-not-allowed"
      >
        <span class="material-icons text-sm" *ngIf="!isUploading">cloud_upload</span>
        <span class="material-icons text-sm animate-spin" *ngIf="isUploading">refresh</span>
        {{ isUploading ? 'Uploading...' : 'Upload Rooms' }}
      </button>
    </div>

    <!-- Upload Progress/Results -->
    <div *ngIf="uploadResults" class="mt-6 border-t pt-6">
      <h3 class="font-semibold text-gray-800 mb-3">Upload Results</h3>
      
      <!-- Summary -->
      <div class="grid grid-cols-3 gap-3 mb-4">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-center">
          <p class="text-xs text-blue-600 font-medium">Total Processed</p>
          <p class="text-xl font-bold text-blue-700">{{ uploadResults.total_processed }}</p>
        </div>
        <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-center">
          <p class="text-xs text-green-600 font-medium">Successfully Created</p>
          <p class="text-xl font-bold text-green-700">{{ uploadResults.successfully_created }}</p>
        </div>
        <div class="bg-red-50 border border-red-200 rounded-lg p-3 text-center">
          <p class="text-xs text-red-600 font-medium">Skipped</p>
          <p class="text-xl font-bold text-red-700">{{ uploadResults.skipped }}</p>
        </div>
      </div>

      <!-- Created Rooms List -->
      <div *ngIf="uploadResults.created_rooms && uploadResults.created_rooms.length > 0" class="mb-4">
        <p class="text-sm font-semibold text-gray-700 mb-2">✅ Created Rooms:</p>
        <div class="bg-green-50 border border-green-200 rounded-lg p-3 max-h-40 overflow-y-auto">
          <div *ngFor="let room of uploadResults.created_rooms" class="text-xs text-green-700 py-1 border-b border-green-200 last:border-b-0">
            <strong>{{ room.room_no }}</strong> (ID: {{ room.room_id }}) - Type ID: {{ room.room_type_id }}
          </div>
        </div>
      </div>

      <!-- Skipped Rooms List -->
      <div *ngIf="uploadResults.skipped_rooms && uploadResults.skipped_rooms.length > 0">
        <p class="text-sm font-semibold text-gray-700 mb-2">⚠️ Skipped Rooms:</p>
        <div class="bg-red-50 border border-red-200 rounded-lg p-3 max-h-40 overflow-y-auto">
          <div *ngFor="let room of uploadResults.skipped_rooms" class="text-xs text-red-700 py-1 border-b border-red-200 last:border-b-0">
            <strong>{{ room.room_no }}:</strong> {{ room.reason }}
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
