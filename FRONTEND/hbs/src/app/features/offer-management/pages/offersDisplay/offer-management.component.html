<app-admin-navbar></app-admin-navbar>

<div class="bg-gray-50 min-h-screen">
  <div class="flex flex-col lg:flex-row flex-1 w-full mt-16 md:mt-20">
    <!-- Sidebar -->
    <div class="w-full lg:w-64 px-4 md:px-6 lg:px-8 py-4 shrink-0">
      <app-admin-sidebar></app-admin-sidebar>
    </div>

    <!-- Main Content -->
    <main class="flex-1 w-full px-4 md:px-6 lg:px-8 py-4 space-y-4">
      <!-- Header -->
      <div class="relative rounded-lg p-[3px] bg-linear-to-r from-yellow-600 to-red-700 shadow">
        <div class="bg-[#fdfaf4] rounded-lg py-4 md:py-6 px-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h2 class="text-2xl md:text-3xl text-gray-800 font-bold">Offers Management</h2>
              <p class="text-gray-600 text-xs md:text-sm mt-1">Create, edit, and manage hotel offers</p>
            </div>
            <button (click)="createNewOffer()" class="flex items-center gap-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition font-medium w-full md:w-auto">
              <span class="material-icons">add</span>
              Create New Offer
            </button>
          </div>
        </div>
      </div>

<div>
  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- Filters & Search -->
    <div class="advanced-filters bg-white rounded-lg border border-gray-200 p-4 mb-4">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-sm font-semibold text-gray-700">Advanced Filters</h3>
        <button (click)="resetFilters()" class="text-xs text-yellow-600 hover:text-yellow-700 underline">
          Reset All
        </button>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-3">
        <!-- Status Filter -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
          <select [(ngModel)]="filterActive" class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs">
            <option value="all">All</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>

        <!-- Min Discount -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">Min %</label>
          <input
            type="number"
            min="0"
            max="100"
            placeholder="0"
            [(ngModel)]="minDiscount"
            class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs"
          />
        </div>

        <!-- Max Discount -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">Max %</label>
          <input
            type="number"
            min="0"
            max="100"
            placeholder="100"
            [(ngModel)]="maxDiscount"
            class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs"
          />
        </div>

        <!-- Start Date -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">From</label>
          <input
            type="date"
            [(ngModel)]="startDate"
            class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs"
          />
        </div>

        <!-- End Date -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">To</label>
          <input
            type="date"
            [(ngModel)]="endDate"
            class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs"
          />
        </div>

        <!-- Room Type Filter -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">Room Type</label>
          <select
            [(ngModel)]="selectedRoomTypeId"
            class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs"
            [disabled]="loadingRoomTypes"
          >
            <option [ngValue]="null">All</option>
            <option *ngFor="let rt of roomTypes" [ngValue]="rt.room_type_id">
              {{ rt.type_name }}
            </option>
          </select>
        </div>

        <!-- Sort Control -->
        <div class="filter-group">
          <label class="block text-xs font-medium text-gray-600 mb-1">Sort by</label>
          <select [(ngModel)]="sortBy" class="w-full px-2 py-1.5 border border-gray-300 rounded text-xs">
            <option value="date">Newest</option>
            <option value="name">Name</option>
            <option value="discount">Discount</option>
          </select>
        </div>

        <!-- Search Button -->
        <div class="filter-group flex items-end">
          <button
            (click)="onFilterChange()"
            class="w-full px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 text-white rounded text-xs font-medium transition flex items-center justify-center gap-1"
          >
            <span class="material-icons text-sm">search</span>
            Search
          </button>
        </div>
      </div>
    </div>


  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading offers...</p>
  </div>

  <!-- Offers Table -->
  <div *ngIf="!loading && paginatedOffers.length > 0" class="offers-table-container">
    <table class="offers-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Discount</th>
          <th>Valid Period</th>
          <th>Usage</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let offer of paginatedOffers" [class.inactive]="!offer.is_active">
          <td class="name">
            <strong>{{ offer.offer_name }}</strong>
          </td>
          <td class="description">{{ offer.description || '—' }}</td>
          <td class="discount">
            <span class="discount-badge">{{ offer.discount_percent }}%</span>
          </td>
          <td class="validity">
            {{ offer.valid_from | date: 'MMM dd, yyyy' }} -
            {{ offer.valid_to | date: 'MMM dd, yyyy' }}
            <span
              class="validity-status"
              [class.status-active]="getValidityStatus(offer.valid_from, offer.valid_to) === 'active'"
              [class.status-upcoming]="getValidityStatus(offer.valid_from, offer.valid_to) === 'upcoming'"
              [class.status-expired]="getValidityStatus(offer.valid_from, offer.valid_to) === 'expired'"
            >
              {{ getValidityStatus(offer.valid_from, offer.valid_to) }}
            </span>
          </td>
          <td class="usage">
            <div class="usage-bar">
              <div
                class="usage-progress"
                [style.width.%]="getUsagePercentage(offer.current_uses, offer.max_uses)"
              ></div>
            </div>
            <small>{{ offer.current_uses }} / {{ offer.max_uses || '∞' }}</small>
          </td>
          <td class="status">
            <span class="status-badge" [class.active]="offer.is_active" [class.inactive]="!offer.is_active">
              {{ offer.is_active ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td class="actions">
            <button
              class="btn-action btn-view"
              (click)="viewOffer(offer.offer_id)"
              title="View offer details"
            >
              <span class="material-icons">visibility</span>
            </button>
            <button
              class="btn-action btn-edit"
              (click)="editOffer(offer.offer_id)"
              title="Edit offer"
            >
              <span class="material-icons">edit</span>
            </button>
            <button
              class="btn-action btn-toggle"
              (click)="toggleOfferStatus(offer)"
              [title]="offer.is_active ? 'Deactivate' : 'Activate'"
            >
              <span class="material-icons">
                {{ offer.is_active ? 'visibility_off' : 'visibility' }}
              </span>
            </button>
            <button
              class="btn-action btn-delete"
              (click)="deleteOffer(offer)"
              title="Delete offer"
            >
              <span class="material-icons">delete</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && paginatedOffers.length === 0" class="empty-state">
    <span class="material-icons">local_offer</span>
    <p>No offers found</p>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && totalRecords > 0" class="px-4 py-4 border-t bg-gray-50 flex flex-col sm:flex-row items-center justify-between gap-4">
    <div class="text-sm text-gray-600">
      Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalRecords) }} of {{ totalRecords }} results
    </div>
    
    <div class="flex items-center gap-2">
      <!-- Items per page -->
      <select
        [(ngModel)]="pageSize"
        (change)="changePageSize(pageSize)"
        class="px-3 py-1 border rounded text-sm"
      >
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }} per page</option>
      </select>

      <!-- Page navigation -->
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="px-3 py-1 border rounded text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <button
        *ngFor="let page of getPageNumbers()"
        (click)="goToPage(page)"
        [class.bg-yellow-600]="page === currentPage"
        [class.text-white]="page === currentPage"
        [class.hover:bg-gray-100]="page !== currentPage"
        class="px-3 py-1 border rounded text-sm transition"
      >
        {{ page }}
      </button>
      
      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="px-3 py-1 border rounded text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
    </div>
    </main>
  </div>
</div>