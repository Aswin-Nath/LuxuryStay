<!-- Header -->
<header class="flex justify-between items-center bg-white shadow-md px-6 py-4 sticky top-0 z-9999">
  <a routerLinkActive="text-amber-700" class="flex items-center space-x-2">
    <img src="/assets/images/Hotel_logo.png" alt="Hotel Logo"
         class="h-8 sm:h-10 rounded-full border-2 border-yellow-600 p-1">
    <h1 class="text-lg sm:text-xl font-bold text-yellow-700">LuxuryStay</h1>
  </a>
</header>

<div class="min-screen-fix min-h-screen flex items-center justify-center bg-gray-100 px-4 relative">

  <!-- === FULL SCREEN LOADER DURING RESET === -->
  <div *ngIf="loadingReset"
       class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-99999 animate-fadeIn">
    <div class="bg-white px-7 py-6 rounded-2xl shadow-2xl flex flex-col items-center">
      <div class="loader mb-3"></div>
      <p class="text-gray-700 font-semibold text-sm tracking-wide">Resetting your password…</p>
    </div>
  </div>

  <!-- Main box -->
  <div class="w-full max-w-md">
    <div class="bg-white rounded-2xl border shadow-xl overflow-hidden">

      <!-- Header -->
      <div class="bg-linear-to-r from-amber-600 to-yellow-500 text-white text-center py-6 px-4">
        <h2 class="text-2xl font-bold">Forgot Password?</h2>
        <p class="text-sm opacity-90 mt-1">We’ll help you recover access</p>
      </div>

      <div class="px-6 py-6">

        <!-- FORM LEVEL ERROR -->
        <div *ngIf="formError" class="bg-red-100 border border-red-400 text-red-600 px-3 py-2 rounded mb-4 text-sm">
          {{ formError }}
        </div>

        <!-- EMAIL -->
        <label class="form-label">Email Address *</label>
        <input
          type="email"
          [(ngModel)]="email"
          placeholder="Enter your email"
          class="form-input"
          (input)="onEmailInput()"
          [ngClass]="{ 'border-red-500 ring-1 ring-red-400': emailError }"
        />
        <div *ngIf="emailError" class="error-msg">{{ emailError }}</div>

        <button
          (click)="sendResetLink()"
          [disabled]="loadingSend || resendCooldownSeconds > 0"
          class="btn-primary mt-5"
          [class.opacity-50]="loadingSend || resendCooldownSeconds > 0"
        >
          <span *ngIf="!loadingSend">Send Reset Link</span>
          <span *ngIf="loadingSend" class="flex items-center gap-2">
            <span class="mini-loader"></span> Sending...
          </span>
        </button>

        <!-- OTP AREA -->
        <div *ngIf="showOtpFields" class="animate-slideUp mt-6">

          <label class="form-label">OTP *</label>
          <input
            #otpInput
            type="text"
            [(ngModel)]="otp"
            maxlength="8"
            placeholder="Enter OTP"
            class="form-input"
            (input)="onOtpInput()"
            [ngClass]="{ 'border-red-500 ring-1 ring-red-400': otpError }"
          />
          <div *ngIf="otpError" class="error-msg">{{ otpError }}</div>

          <!-- RESEND -->
          <div class="text-right mt-2 text-sm text-gray-600">
            Didn’t receive OTP?
            <ng-container *ngIf="resendCooldownSeconds <= 0">
              <a (click)="sendResetLink()" class="text-amber-600 hover:underline ml-1 cursor-pointer">Resend</a>
            </ng-container>
            <ng-container *ngIf="resendCooldownSeconds > 0">
              <span class="ml-1 text-gray-400">Resend ({{ resendCooldownSeconds }}s)</span>
            </ng-container>
          </div>

          <!-- PASSWORD -->
          <label class="form-label mt-4">New Password *</label>
          <input
            type="password"
            [(ngModel)]="newPassword"
            placeholder="New password"
            class="form-input"
            (input)="onNewPasswordInput()"
            [ngClass]="{ 'border-red-500 ring-1 ring-red-400': passwordError }"
          />
          <div *ngIf="passwordError" class="error-msg">{{ passwordError }}</div>

          <button
            (click)="verifyOtpAndReset()"
            [disabled]="loadingReset"
            class="btn-primary mt-5"
            [class.opacity-50]="loadingReset"
          >
            <span *ngIf="!loadingReset">Reset Password</span>
            <span *ngIf="loadingReset" class="flex items-center gap-2">
              <span class="mini-loader"></span> Processing...
            </span>
          </button>

        </div>

        <p class="text-center text-sm text-gray-600 mt-4">
          Back to
          <a type="button" routerLink="/login" routerLinkActive class="text-amber-600 hover:underline font-semibold">Sign In</a>
        </p>

      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div #toast class="toast fixed top-6 right-6 hidden opacity-0 translate-y-2 z-50">
    <div class="flex items-center gap-2 text-white">
      <span id="toastIcon" class="material-icons text-sm">info</span>
      <span id="toastMessage">Message</span>
    </div>
  </div>

</div>
